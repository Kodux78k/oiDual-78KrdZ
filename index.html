<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Dual.Vault v9 - 78KrdZ</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="manifest" href="./manifest.webmanifest">
<meta name="theme-color" content="#050505">

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./sw.js")
    .then(() => console.log("SW ok"))
    .catch(e => console.log("SW erro", e));
}
</script>

<link rel="apple-touch-icon" href="./icon-192.png">
    
   
    
    
    <style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');

:root {
    --bg: #050505;
    --glass: rgba(30, 30, 30, 0.4);
    --border: rgba(255, 255, 255, 0.08);
    --neon-p: #d946ef; /* Magenta Cyber */
    --neon-o: #f97316; /* Laranja Hub */
    --neon-b: #3b82f6; /* Azul Warframe */
}

body {
    background: var(--bg);
    font-family: 'Plus Jakarta Sans', sans-serif;
    display: flex; flex-direction: column; align-items: center;
    padding: 20px 10px; min-height: 100vh; color: #e2e8f0;
    overflow-x: hidden;
}

/* --- CARD SYSTEM --- */
.master-card {
    width: 100%; max-width: 460px;
    background: var(--glass); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
    border-radius: 24px; border: 1px solid var(--border);
    margin-bottom: 16px; position: relative; overflow: hidden;
    transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 0 8px 32px rgba(0,0,0,0.6);
}

/* Aura de Sele√ß√£o */
.master-card:focus-within { border-color: var(--neon-b); box-shadow: 0 0 15px rgba(59, 130, 246, 0.2); }

.inner { padding: 14px; }

/* HEADER */
.header { display: flex; justify-content: space-between; align-items: center; min-height: 44px; }
.title-group { flex-grow: 1; cursor: pointer; display: flex; flex-direction: column; overflow: hidden; }
.card-title { font-weight: 800; font-size: 14px; color: #f8fafc; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.card-meta { font-size: 10px; color: #94a3b8; font-family: 'JetBrains Mono', monospace; display: flex; gap: 8px; align-items: center; margin-top: 2px;}
.tag-badge { background: rgba(255,255,255,0.1); padding: 1px 6px; border-radius: 4px; color: var(--neon-p); }

/* DOCK DE A√á√ÉO */
.dock { display: flex; gap: 6px; align-items: center; padding-left: 8px;}
.ico {
    width: 34px; height: 34px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
    color: #cbd5e1; cursor: pointer; transition: all 0.2s;
    flex-shrink: 0;
}
.ico:hover { background: rgba(255,255,255,0.1); color: white; transform: scale(1.05); }
.ico:active { transform: scale(0.95); }

/* CORES DE A√á√ÉO */
.ico.flash { color: var(--neon-o); border-color: rgba(249, 115, 22, 0.3); }
.ico.tts { color: var(--neon-b); }
.ico.share { color: #10b981; }
.ico.del:hover { background: #ef4444; color: white; border-color: #ef4444; }

/* CONTE√öDO EXPANS√çVEL */
.content-box {
    max-height: 0; overflow: hidden; opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.expanded .content-box { max-height: 800px; opacity: 1; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); }

/* INPUTS & WARFRAME */
.code-area {
    width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border);
    border-radius: 12px; padding: 12px; color: #e2e8f0;
    font-family: 'JetBrains Mono', monospace; font-size: 12px; line-height: 1.5;
    outline: none; resize: vertical; min-height: 100px;
}
.warframe-view {
    width: 100%; height: 200px; border: none; background: white;
    border-radius: 12px; margin-top: 8px;
}

/* CAMADA EXTERNA (Inject Outside) */
#ext-layer { width: 100%; max-width: 460px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }
.ext-card-wrap { animation: slideIn 0.3s ease; }

@keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

/* GROUP FILTER */
.filter-bar {
    width: 100%; max-width: 460px; display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px;
}
.filter-pill {
    background: var(--glass); border: 1px solid var(--border); color: #94a3b8;
    padding: 6px 16px; border-radius: 20px; font-size: 11px; font-weight: 600;
    cursor: pointer; white-space: nowrap; transition: 0.2s;
}
.filter-pill.active { background: var(--neon-p); color: white; border-color: var(--neon-p); }

</style>
</head>
<body>

<div id="ext-layer"></div>

<div class="filter-bar" id="filterBar">
    <div class="filter-pill active" onclick="filterVault('ALL')">ALL</div>
    <div class="filter-pill" onclick="filterVault('CODE')">CODE</div>
    <div class="filter-pill" onclick="filterVault('DOCS')">DOCS</div>
</div>

<div class="master-card" id="main">
    <div class="inner">
        <div class="header">
            <div class="title-group" onclick="toggle('main')">
                <span class="card-title" style="letter-spacing: 1px; color: var(--neon-o);">‚ö° INFINITY INJECTOR</span>
                <span class="card-meta">WARFRAME_READY ‚Ä¢ v9.0</span>
            </div>
            <div class="dock">
                <button class="ico flash" onclick="magicPaste()" title="Clipboard Turbo Save">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
                </button>
                <button class="ico" onclick="toggle('main')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </button>
            </div>
        </div>
        
        <div class="content-box">
            <div style="position: relative;">
                <textarea id="mainInput" class="code-area" rows="4" placeholder="‚çØ"></textarea>
                <button onclick="pasteToInput()" style="position: absolute; bottom: 8px; right: 8px; background: var(--neon-p); color: white; border: none; padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: bold; cursor: pointer;">
                    ‚ßâ
                </button>
            </div>
            
            <div style="display: flex; gap: 8px; margin-top: 10px;">
                <input id="mainGroup" placeholder="(StkZ)" style="background:transparent; border:1px solid var(--border); color:white; padding:8px; border-radius:8px; width: 20%; font-size: 11px;">
                
                <button class="ico" style="flex:1; border-radius: 8px; width:auto; font-size: 11px; font-weight:700; gap:6px;" onclick="saveManual()">
                   ‚ò•ÿ≥Œ£9‚Ä¢
                </button>
                <button class="ico" style="flex:1; border-radius: 8px; width:auto; font-size: 11px; font-weight:700; gap:6px; color: var(--neon-b); border-color: rgba(59,130,246,0.3);" onclick="injectExternal()">
                   ‚ï∞‚Ü≥KrdZ‚Ü¥
                </button>
              <input type="file" id="importFile" accept=".json,.html,.md,.patch,.rds, .css, .js, .txt" style="display:none" onchange="importBackup(event)">
<button class="ico" style="flex:1; border-radius: 8px; font-size: 11px; font-weight:700;" onclick="document.getElementById('importFile').click()">
   Ôø¨‚üêÔø¨‚ßâÔø¨
</button>
            </div>
        </div>
    </div>
</div>

<div id="vault" style="width: 100%; max-width: 460px;"></div>

<script>
let items = JSON.parse(localStorage.getItem('vault_v9') || '[]');
let currentFilter = 'ALL';
let editingId = null;

// --- SISTEMA DE RENDERIZA√á√ÉO ---
function render() {
    const v = document.getElementById('vault');
    const filtered = currentFilter === 'ALL' ? items : items.filter(i => (i.group || '').toUpperCase() === currentFilter);
    
    v.innerHTML = filtered.map(i => {
        const isEditing = editingId === i.id;
        
        // MODO EDI√á√ÉO
        if (isEditing) {
            return `
            <div class="master-card expanded" id="card-${i.id}">
                <div class="inner">
                    <div class="header">
                        <input id="edit-title-${i.id}" value="${i.title}" class="code-area" style="height:34px; min-height:auto; padding:5px 10px; width: 60%;">
                        <input id="edit-group-${i.id}" value="${i.group||''}" class="code-area" style="height:34px; min-height:auto; padding:5px 10px; width: 20%; margin-left:5px;">
                        <div class="dock" style="margin-left: auto;">
                            <button class="ico flash" onclick="saveEdit(${i.id})">‚úì</button>
                        </div>
                    </div>
                    <div class="content-box" style="opacity:1; max-height:none;">
                        <textarea id="edit-content-${i.id}" class="code-area" rows="8">${i.content}</textarea>
                    </div>
                </div>
            </div>`;
        }
        
        // MODO VISUALIZA√á√ÉO
        return `
        <div class="master-card" id="card-${i.id}">
            <div class="inner">
                <div class="header">
                    <div class="title-group" onclick="toggle('card-${i.id}')">
                        <div style="display:flex; justify-content:space-between; width:100%;">
                            <span class="card-title">${i.title}</span>
                            <span class="card-meta">${i.date.split(' ')[0]}</span>
                        </div>
                        <span class="card-meta">
                            ${i.group ? `<span class="tag-badge">${i.group}</span>` : ''} 
                            ID:${i.id.toString().slice(-4)}
                        </span>
                    </div>
                    
                    <div class="dock">
                        <button class="ico tts" onclick="event.stopPropagation(); speakCard(${i.id})">
                            <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>
                        </button>

                        <button class="ico share" onclick="event.stopPropagation(); shareCard(${i.id})">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                        </button>

                        <button class="ico" onclick="event.stopPropagation(); toggleRender(${i.id})">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                        </button>

                        <button class="ico" onclick="event.stopPropagation(); startEdit(${i.id})">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                        </button>

                         <button class="ico del" onclick="event.stopPropagation(); deleteCard(${i.id})">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    </div>
                </div>
                
                <div class="content-box" id="box-${i.id}">
                    <textarea readonly class="code-area" id="txt-${i.id}" style="border:none; padding:0; background:transparent;">${i.content}</textarea>
                    <div id="frame-container-${i.id}" style="display:none;"></div>
                </div>
            </div>
        </div>`;
    }).join('');
}

// --- FUN√á√ïES DE L√ìGICA ---

// 1. Alternar Card
function toggle(id) {
    if(editingId && editingId !== `card-${id}` && id !== 'main') cancelEdit();
    document.getElementById(id).classList.toggle('expanded');
}

// 2. Cria√ß√£o
function saveManual() {
    const text = document.getElementById('mainInput').value;
    const group = document.getElementById('mainGroup').value;
    if(text) { createCard(text, group); document.getElementById('mainInput').value = ''; toggle('main'); }
}

async function magicPaste() {
    try {
        const text = await navigator.clipboard.readText();
        if(!text) return alert("Clipboard Vazio");
        createCard(text, "CLIPBOARD");
        speak("Card Criado");
    } catch(e) { alert("Permiss√£o de colar negada"); }
}

async function pasteToInput() {
    try {
        const text = await navigator.clipboard.readText();
        document.getElementById('mainInput').value += text;
    } catch(e) { alert("Permiss√£o negada"); }
}

function createCard(content, group = "") {
    const lines = content.trim().split('\n');
    const title = lines[0].substring(0, 35).replace(/[#<*]/g,'').trim() || "Sem T√≠tulo";
    const item = { 
        id: Date.now(), 
        title, 
        content, 
        group: group.toUpperCase(), 
        date: new Date().toLocaleDateString('pt-BR') + ' ' + new Date().toLocaleTimeString('pt-BR').slice(0,5) 
    };
    items.unshift(item);
    save();
}

// 3. Compartilhar (WhatsApp etc)
async function shareCard(id) {
    const item = items.find(i => i.id === id);
    if (navigator.share) {
        try {
            await navigator.share({
                title: item.title,
                text: item.content
            });
        } catch (err) { console.log('Share cancelado'); }
    } else {
        // Fallback: Copiar
        navigator.clipboard.writeText(item.content);
        alert("Copiado para Clipboard (Share n√£o suportado)");
    }
}

// 4. TTS (Fala)
function speakCard(id) {
    const item = items.find(i => i.id === id);
    speak(item.content);
}

function speak(txt) {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(txt);
    u.lang = "pt-BR"; u.rate = 1.2;
    window.speechSynthesis.speak(u);
}

// 5. Warframe / Render
function toggleRender(id) {
    const txt = document.getElementById(`txt-${id}`);
    const frameBox = document.getElementById(`frame-container-${id}`);
    const item = items.find(i => i.id === id);

    if (frameBox.style.display === 'none') {
        // Ativar Warframe
        txt.style.display = 'none';
        frameBox.style.display = 'block';
        frameBox.innerHTML = `<iframe class="warframe-view" srcdoc="${item.content.replace(/"/g, '&quot;')}" sandbox="allow-scripts"></iframe>`;
    } else {
        // Voltar p/ C√≥digo
        txt.style.display = 'block';
        frameBox.style.display = 'none';
        frameBox.innerHTML = '';
    }
}

// 6. Inject Outside (Visual Card Style)
function injectExternal() {
    const val = document.getElementById('mainInput').value;
    const title = val.split('\n')[0].substring(0,20) || "External";
    
    // Cria a estrutura visual do card
    const cardHTML = `
        <div class="master-card ext-card-wrap">
            <div class="inner">
                <div class="header">
                     <span class="card-title" style="color:var(--neon-b)">üöÄ ${title}</span>
                     <div class="dock"><button class="ico del" onclick="this.closest('.ext-card-wrap').remove()">√ó</button></div>
                </div>
                <div style="margin-top:10px; color:#ccc; font-size:13px;">
                    ${val} 
                </div>
            </div>
        </div>
    `;
    
    const d = document.createElement('div');
    d.innerHTML = cardHTML;
    document.getElementById('ext-layer').appendChild(d);
    document.getElementById('mainInput').value = '';
}
function importBackup(ev) {
    const file = ev.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
        try {
            const data = JSON.parse(e.target.result);

            if (!Array.isArray(data)) {
                alert("Arquivo inv√°lido: n√£o √© uma lista de cards.");
                return;
            }

            let count = 0;

            data.forEach(card => {
                if (card.content) {
                    // garantir id √∫nico
                    card.id = Date.now() + Math.floor(Math.random() * 9999);
                    items.unshift(card);
                    count++;
                }
            });

            save();
            alert(count + " cards importados com sucesso!");
        } catch (err) {
            alert("Erro ao ler arquivo JSON.");
        }
    };

    reader.readAsText(file);
}
// --- CRUD ---
function startEdit(id) { editingId = id; render(); document.getElementById(`card-${id}`).classList.add('expanded'); }
function cancelEdit() { editingId = null; render(); }

function saveEdit(id) {
    const item = items.find(i => i.id === id);
    item.title = document.getElementById(`edit-title-${id}`).value;
    item.group = document.getElementById(`edit-group-${id}`).value.toUpperCase();
    item.content = document.getElementById(`edit-content-${id}`).value;
    item.date = new Date().toLocaleDateString() + " (Edit)";
    editingId = null;
    save();
}

function deleteCard(id) {
    if(confirm('Deletar Card?')) {
        items = items.filter(i => i.id !== id);
        save();
    }
}

function filterVault(filter) {
    currentFilter = filter;
    document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
    event.target.classList.add('active');
    render();
}

function save() {
    localStorage.setItem('vault_v9', JSON.stringify(items));
    render();
}

// Init
render();
</script>
</body>
</html>
